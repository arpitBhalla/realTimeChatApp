$(document).ready((function(){const addNewChat=(chat,byMe=!1)=>{$(".messages").append($(`<div class="msg msg--${byMe?"them":"me"}"></div>`).append($('<div class="blockquote"></div>').append($('<div class="by"></div>').text(chat.displayName),$('<div class="text"></div>').text(chat.text),$('<div class="time"></div>').text(chat.time)))),$(".messages").animate({scrollTop:2e7},"slow")},socket=io();let displayName,uid;localStorage.getItem("uid")&&""!=localStorage.getItem("uid")?(displayName=localStorage.getItem("displayName"),uid=localStorage.getItem("uid")):(displayName=prompt("Enter name")||"User",uid=(new Date).getTime().toString(),localStorage.setItem("displayName",displayName),localStorage.setItem("uid",uid));const userBox=users=>{let index=users.indexOf(displayName);index>-1&&users.splice(index,1),$(".contact--userBox").text("You, "+users)};socket.emit("connected",uid,displayName,(function(chats,users){chats.forEach(chat=>{addNewChat(chat,chat.uid==uid)}),userBox(users)})),socket.on("new connection",(function(user,users){$(".messages").append(`<h3 class="msg--date">${user} connected</h3>`),userBox(users)})),socket.on("new chat",(function(chat){addNewChat(chat)})),socket.on("getTyping",(function(name){$(".contact--typingBox").text(name+" is typing..."),$(".contact--typingBox").show(),$(".contact--userBox").hide(),setTimeout((function(){$(".contact--typingBox").hide(),$(".contact--userBox").show()}),2e3)})),$(".msg-send").click((function(){if(""==$("input").val().trim())return 0;const chat={uid:uid,displayName:displayName,text:$("input").val().trim(),time:(new Date).toLocaleTimeString()};addNewChat(chat,!0),$("input").val(""),socket.emit("send",chat,(function(data){console.log(data)}))})),$("input").keyup((function(e){13==e.keyCode?($(".msg-send").click(),$(".contact--typingBox").hide(),$(".contact--userBox").show()):socket.emit("typing",displayName)}))}));